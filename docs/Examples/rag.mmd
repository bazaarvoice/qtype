flowchart TD
    subgraph APP ["ðŸ“± Application: rag_example"]
        direction TB

    subgraph FLOW_0 ["ðŸ”„ Flow: rag_chat
Chat with the document collection using RAG"]
        direction LR
        FLOW_0_START@{shape: circle, label: "â–¶ï¸ Start"}
        FLOW_0_S0@{shape: rect, label: "âš™ï¸ Step: extract_question"}
        FLOW_0_S1@{shape: cyl, label: "ðŸ”Ž Vector Search: search_index"}
        FLOW_0_S2@{shape: doc, label: "ðŸ“„ Template: build_prompt"}
        FLOW_0_S3@{shape: rounded, label: "âœ¨ generate_response"}
        FLOW_0_START -->|user_message: ChatMessage'>| FLOW_0_S0
        FLOW_0_S0 -->|user_question: text| FLOW_0_S1
        FLOW_0_S1 -->|"search_results: list[RAGSearchResult]"| FLOW_0_S2
        FLOW_0_S0 -->|user_question: text| FLOW_0_S2
        FLOW_0_S2 -->|context_prompt: text| FLOW_0_S3
    end

    subgraph FLOW_1 ["ðŸ”„ Flow: document_ingestion
Load LlamaIndex Q&A pairs from HuggingFace, split, embed, and index documents"]
        direction TB
        FLOW_1_S0@{shape: rect, label: "âš™ï¸ Step: load_documents"}
        FLOW_1_S1@{shape: rect, label: "âš™ï¸ Step: split_documents"}
        FLOW_1_S2@{shape: rect, label: "âš™ï¸ Step: embed_chunks"}
        FLOW_1_S3@{shape: rect, label: "âš™ï¸ Step: index_chunks"}
        FLOW_1_S0 -->|raw_document: RAGDocument'>| FLOW_1_S1
        FLOW_1_S1 -->|document_chunk: RAGChunk'>| FLOW_1_S2
        FLOW_1_S2 -->|embedded_chunk: RAGChunk'>| FLOW_1_S3
    end

    subgraph RESOURCES ["ðŸ”§ Shared Resources"]
        direction LR
        AUTH_AWS_AUTH@{shape: hex, label: "ðŸ” aws_auth\nAWS"}
        MODEL_CLAUDE_SONNET@{shape: rounded, label: "âœ¨ claude_sonnet (aws-bedrock)" }
        MODEL_CLAUDE_SONNET -.->|uses| AUTH_AWS_AUTH
        MODEL_TITAN_EMBED_V2@{shape: rounded, label: "âœ¨ titan_embed_v2 (aws-bedrock)" }
        MODEL_TITAN_EMBED_V2 -.->|uses| AUTH_AWS_AUTH
    end

    end

    FLOW_0_S1 -.-> INDEX_RAG_INDEX
    FLOW_0_S3 -.->|uses| MODEL_CLAUDE_SONNET

    %% Styling
    classDef appBox fill:none,stroke:#495057,stroke-width:3px
    classDef flowBox fill:#e1f5fe,stroke:#0277bd,stroke-width:2px
    classDef llmNode fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef modelNode fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
    classDef authNode fill:#fff3e0,stroke:#ef6c00,stroke-width:2px
    classDef telemetryNode fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    classDef resourceBox fill:#f5f5f5,stroke:#616161,stroke-width:1px

    class APP appBox
    class FLOW_0 flowBox
    class RESOURCES resourceBox
    class TELEMETRY telemetryNode