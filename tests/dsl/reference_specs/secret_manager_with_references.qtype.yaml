# Test spec for secret manager with secret references
# This file tests that:
# 1. SecretManager can be defined in the application
# 2. SecretReference can be used in auth provider fields
# 3. SecretReference can reference different secret types (plain secrets and JSON keys)

id: test_secret_manager

# Auth provider for AWS Secrets Manager itself
auths:
  - id: aws_auth
    type: aws
    access_key_id:
      secret_name: my-app/aws-credentials
      key: access_key_id
    secret_access_key:
      secret_name: my-app/aws-credentials
      key: secret_access_key
  
  # API key auth with secret reference to plain secret
  - id: openai_auth
    type: api_key
    api_key:
      secret_name: my-app/openai-api-key
  
  # Bearer token auth with secret reference to JSON key
  - id: github_auth
    type: bearer_token
    token:
      secret_name: my-app/github-tokens
      key: personal_access_token
  
  # OAuth2 auth with secret reference
  - id: oauth_auth
    type: oauth2
    client_id: my-client-id
    client_secret:
      secret_name: my-app/oauth-secrets
      key: client_secret
    token_url: https://auth.example.com/token

# Configure AWS Secrets Manager
secret_manager:
  id: main_secret_manager
  type: aws_secret_manager
  auth: aws_auth

# Model using auth with secret reference
models:
  - type: Model
    id: gpt4
    provider: openai
    model_id: gpt-4
    auth: openai_auth

# Flow with minimal structure
flows:
  - id: test_flow
    variables:
      - id: name
        type: text
      - id: greeting
        type: text
    steps:
      - id: test_step
        type: PromptTemplate
        template: "Hello {name}"
        inputs:
          - name
        outputs:
          - greeting
